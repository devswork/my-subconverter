# subconverter 节点和规则编写思路

假设有google.list、twitter.list、youtube.list 规则，那么对于多机场而言，需要根据这些App的特性和机场审计：
- 限制地区 (比如：bing美版 vs CN版)
- 站点是否敏感 (比如：海外新闻站，某些机场是存在审计，连接会被deny) 
- 国家地区延迟 (比如：youtube在香港延迟最低)

来决定使用哪些节点，但尽可能减少“人”对“节点切换”的管理（懒）。

因为不同地区对节点连接是不稳定的，存在一会可以，一会就断连，所以总是需要在连接不上的时候，人工去切换。

### 如何解决节点管理问题？
既然clash拥有 select、url-test、fallback 策略，对于多机场而言，需要充分利用三种策略，对上面提到的App特性、延迟、审计等问题，需要对节点进行分组，然后将App规则绑定到这些节点分组上，尽可能的减少人为对节点切换的管理。

### 以机场“节点质量”建立地区节点
每个机场根据线路质量决定策略，按照节点所在地区，进行地区分组，形成自动化选择的地区节点。

组建基于地区的自动化选择节点：

假设机场“ABC”，以香港地区节点为例：
- 若ABC为高质量机场，使用 select OR fallback 策略（并降低 interval ），选择HK地区所有节点，组成 "香港节点(ABC)"
- 若ABC为中低质量机场，使用 url-test 策略（根据质量，质量越低，interval 越短），选择HK地区所有节点，组成 "香港节点(ABC)"

此时，已经根据ABC机场的质量，对地区节点进行了分组。可以认为，只要选择了【香港节点(ABC)】 就代表已经选择了ABC机场的香港最佳节点。

```
custom_proxy_group=香港节点(ABC)`url-test`(港|HK|Hong Kong)`http://www.gstatic.com/generate_204`310,3,100
```
语法：
```
Group_Name`url-test|fallback|load-balance`Rule_1`Rule_2`...`test_url`interval[,timeout][,tolerance]
```
310 表示310秒对本组内的节点测试一次（meta内核lazy机制，如果没有使用该策略，则不进行测试）。
3 表示如果连接超过3秒没有响应，则认为节点不可用，节点无效。
100 表示节点切换的容差，毫秒。表示与当前节点延迟相差多少毫秒会切换。

但此时，地区节点还只是个节点列表，需要将地区节点绑定到App规则上，才能实现自动化选择。


